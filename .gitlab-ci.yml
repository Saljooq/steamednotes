stages:
 - terraform

terraform_setup:
  stage: terraform
  image: registry.gitlab.com/gitlab-org/terraform-images/stable:latest
  script:
    - cd terraform
    - terraform init
    - terraform plan
    - terraform apply -auto-approve
    - terraform output -raw ec2_public_ip > ec2_public_ip.txt
  artifacts:
    paths:
      - terraform/ec2_public_ip.txt
  when: manual